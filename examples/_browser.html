<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<body>
  <div id="result">Checking access...</div>
</body>
<script src="../dist/lilu.umd.js"></script>
<script>
  const user = {
    id: 1,
    name: 'Andrew L.',
    email: 'andrew.io.dev@gmail.com',
    role: ['ROLE_USER']
  };

  const order = {
    title: 'Netflix Subscription',
    owner: 1,
    placedAt: new Date(),
    items: [1, 2, 3, 4]
  };

  const permissions = [{
    title: 'Order Review',
    actions: ['order.view'],
    rules: [{
      title: 'Owned',
      operation: 'AND',
      conditions: [
        'env.hours >= 8',
        'env.hours <= 18',
        'order.owner == user.id',
      ]
    }]
  }, {
    title: 'Order Create',
    actions: ['order.create'],
    rules: [{
      title: 'Owned',
      operation: 'AND',
      conditions: [
        'env.hours >= 8',
        'env.hours <= 18'
      ]
    }]
  }];

  const lilu = window.lilu({
    strict: false,
    enviroment: {
      env: {
        hours: () => (new Date()).getHours(),
        minutes: () => (new Date()).getMinutes()
      },
      user: user
    },
    permissions: permissions
  });

  lilu.grantedMany('order.*', { order }, function(err, result) {
    if (err) {
      console.warn('Failed to process lilu access', err);
      return;
    }

    console.log(result.trace.toString());
    console.log(result.trace.toJSON());

    if (result.passed) {
      document.getElementById('result')
        .innerHTML = 'Yahu!!! I have access to review order.';
    } else {
      document.getElementById('result')
        .innerHTML = 'Oops!! I don\'t have access to review order.';
    }
  });
</script>
</html>
